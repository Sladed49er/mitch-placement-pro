generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Carrier {
  id                String   @id @default(uuid())
  carrierId         String   @unique
  name              String
  amBestRating      String
  provinces         String[]
  linesOfBusiness   String[]
  minPremium        Float
  maxRevenue        Float
  commissionNew     Float
  commissionRenewal Float
  responseTime      String
  apiEnabled        Boolean  @default(false)
  mitchPartner      Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  appetites         CarrierAppetite[]
  placements        Placement[]
}

model CarrierAppetite {
  id              String   @id @default(uuid())
  carrierId       String
  naicsCode       String
  appetiteScore   Int      // 0-100 score
  notes           String?
  
  carrier         Carrier  @relation(fields: [carrierId], references: [id])
  naics           NAICSCode @relation(fields: [naicsCode], references: [code])
  
  @@unique([carrierId, naicsCode])
}

model NAICSCode {
  code            String   @id
  description     String
  category        String
  riskLevel       String   // preferred, standard, substandard, declined
  baseRate        Float    // base premium rate
  
  appetites       CarrierAppetite[]
  placements      Placement[]
}

model Placement {
  id              String   @id @default(uuid())
  clientName      String
  contactEmail    String
  contactPhone    String
  province        String
  naicsCode       String
  revenue         Float
  employees       Int
  yearsInBusiness Int
  lossHistory     String   // clean, minor, moderate, major
  
  estimatedPremium Float
  matchScore      Int
  status          String   // draft, submitted, quoted, bound, declined
  submittedAt     DateTime?
  quotedAt        DateTime?
  boundAt         DateTime?
  
  carrierId       String?
  agentNotes      String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  carrier         Carrier? @relation(fields: [carrierId], references: [id])
  naics           NAICSCode @relation(fields: [naicsCode], references: [code])
}

model MarketIntel {
  id              String   @id @default(uuid())
  date            DateTime @default(now())
  propertyTrend   Float    // percentage change
  casualtyTrend   Float
  cyberTrend      Float
  autoTrend       Float
  marketCondition String   // hard, softening, soft, hardening
  notes           String?
}